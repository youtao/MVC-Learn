<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>signalr</title>
    <meta charset="utf-8" />
    <link href="/Content/font-awesome.min.css" rel="stylesheet" />
    <script src="/Scripts/jquery-3.1.1.min.js"></script>
    <script src="/Scripts/jquery.signalR-2.2.1.min.js"></script>
    <script src="/Scripts/vue.min.js"></script>
    <script src="/Scripts/jquery.signalR-2.2.1.min.js"></script>
    <script src="/assets/js/admin/common.min.js"></script>
    <script src="/signalr/hubs"></script>
</head>
<body style="font-family: 'Microsoft Yahei'" id="body">
    <i class="fa fa-github"></i>
    <ul>
        <li v-for="message in messages">
            <i class="fa fa-user" v-bind:style="message.style"></i>
            <span>{{message.connectionId}}{{message.status}}--{{message.time}}</span>
        </li>
    </ul>
    <script>
        $(function () {
            var vue = new Vue({
                el: '#body',
                data: {
                    messages: []
                }
            });
            var chatHub = $.connection.chatHub;
            chatHub.client.start = function (connctionid) {
                var now = new Date();
                vue.messages.push({
                    connectionId: connctionid,
                    status:'连接',
                    time: now.Format('hh:mm:ss:S'),
                    style: {
                        color: 'green'
                    }
                });
            };
            chatHub.client.leave = function (connctionid) {
                var now = new Date();
                vue.messages.push({
                    connectionId: connctionid,
                    status: '断开',
                    time: now.Format('hh:mm:ss:S'),
                    style: {
                        color: 'gray'
                    }
                });
            };
            $.connection.hub.start()
                .done(function () {
                    chatHub.server.start();
                });

            vue.$watch('messages',
                function (newVal, oldVal) {
                    console.log(newVal);
                    console.log(oldVal);
                });

        });
    </script>
</body>
</html>
