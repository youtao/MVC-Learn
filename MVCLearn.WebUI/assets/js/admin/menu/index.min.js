$(function(){var n={editing:!1,editingId:undefined};$("#menu-list").treegrid({url:"/admin/menu/getmenu",idField:"Id",treeField:"Title",loadMsg:"拼命加载中...",rownumbers:!0,animate:!0,lines:!0,checkOnSelect:!1,selectOnCheck:!1,columns:[[{field:"Unique",checkbox:!0},{field:"Title",title:"标题",width:"30%",editor:"text"},{field:"Url",title:"地址",width:"40%",editor:"text"},{field:"Icon",title:"图标",width:"20%",align:"center",editor:"text",formatter:function(n){return'<i class="'+n+'"><\/i>&nbsp;&nbsp;&nbsp;'+n}}]],toolbar:[{text:"添加",iconCls:"fa fa-plus",handler:function(){if(n.editing){n.editingId!=undefined?$("#menu-list").treegrid("select",n.editingId):$("#menu-list").treegrid("select",-1);return}n.editing=!0;var t=null,i=$("#menu-list").treegrid("getSelected");i&&(t=i.Id);$("#menu-list").treegrid("append",{parent:t,data:[{Id:-1,Title:"",Url:"",Icon:"",ParentId:t}]});$("#menu-list").treegrid("beginEdit",-1)}},"-",{text:"编辑",iconCls:"fa fa-edit",handler:function(){if(n.editing){n.editingId!=undefined?$("#menu-list").treegrid("select",n.editingId):$("#menu-list").treegrid("select",-1);return}var t=$("#menu-list").treegrid("getSelected");t&&(n.editing=!0,n.editingId=t.Id,$("#menu-list").treegrid("beginEdit",n.editingId))}},"-",{text:"保存",iconCls:"fa fa-save",handler:function(){n&&(n.editingId!=undefined?$("#menu-list").treegrid("endEdit",n.editingId):$("#menu-list").treegrid("endEdit",-1),n.editingId=undefined,n.editing=!1)}},"-",{text:"取消",iconCls:"fa fa-undo",handler:function(){$("#menu-list").treegrid("unselectAll");n.editing&&(n.editingId!=undefined?$("#menu-list").treegrid("cancelEdit",n.editingId):$("#menu-list").treegrid("remove",-1),n.editingId=undefined,n.editing=!1)}}],loadFilter:function(n){for(var t=0;t<n.length;t++)n[t].Count&&(n[t].state="closed");return n},onBeforeExpand:function(n){$("#menu-list").treegrid("options").url="/admin/menu/getmenu?ParentId="+n.Id},onAfterEdit:function(n){var t="/admin/menu/edit",i={Id:n.Id,Title:n.Title,Url:n.Url,Icon:n.Icon};n.Id<0&&(i.ParentId=n.ParentId,t="/admin/menu/create");$.post(t,i,function(){n.Id<0&&(n.ParentId?$("#menu-list").treegrid("reload",n.ParentId):($("#menu-list").treegrid("unselectAll"),$("#menu-list").treegrid("reload")))})}});$("#menu-order").tree({url:"/admin/menu/getmenu",dnd:!0,loadFilter:function(n){for(var t=0;t<n.length;t++)n[t].id=n[t].Id,n[t].text=n[t].Title,n[t].Count&&(n[t].state="closed");return n},onBeforeExpand:function(n){$("#menu-order").tree("options").url="/admin/menu/getmenu?ParentID="+n.Id},onDrop:function(n,t,i){var r=0,u="",f;i==="append"?(u=$("#menu-order").tree("getNode",n),u&&(r=u.children.length-1)):(u=$("#menu-order").tree("getParent",n),i==="top"?(r=$("#menu-order").tree("getNode",n).MenuOrder,r!==0&&r--):r=$("#menu-order").tree("getNode",n).MenuOrder+1);f=null;u&&(f=u.Id);$.post("/admin/menu/Order",{Id:t.Id,ParentId:f,MenuOrder:r},function(){})}})});